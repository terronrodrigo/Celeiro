<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <title>Dashboard Volunt√°rios | Celeiro S√£o Paulo</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css?v=1.0.5">
</head>
<body>
  <div class="dashboard">
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="logo">
          <span class="logo-icon">‚óá</span>
          <span class="logo-text">Celeiro SP</span>
        </div>
      </div>
      <nav class="sidebar-nav" id="navAdmin">
        <a href="#" class="nav-item active" data-view="resumo">
          <span class="nav-icon">üìä</span>
          <span>Resumo</span>
        </a>
        <a href="#" class="nav-item" data-view="voluntarios">
          <span class="nav-icon">üë•</span>
          <span>Volunt√°rios</span>
        </a>
        <a href="#" class="nav-item" data-view="ministros">
          <span class="nav-icon">‚õ™</span>
          <span>Minist√©rios</span>
        </a>
        <a href="#" class="nav-item" data-view="usuarios">
          <span class="nav-icon">üîê</span>
          <span>Usu√°rios</span>
        </a>
        <a href="#" class="nav-item" data-view="eventos-checkin">
          <span class="nav-icon">üìÖ</span>
          <span>Eventos Check-in</span>
        </a>
        <a href="#" class="nav-item" data-view="checkin">
          <span class="nav-icon">‚úÖ</span>
          <span>Check-in</span>
        </a>
        <a href="#" class="nav-item" data-view="checkin-ministerio" id="navAdminCheckinMinisterio" style="display: none;">
          <span class="nav-icon">‚úÖ</span>
          <span>Check-ins dos meus minist√©rios</span>
        </a>
        <a href="#" class="nav-item" data-view="escalas-criar">
          <span class="nav-icon">‚ûï</span>
          <span>Criar escalas</span>
        </a>
        <a href="#" class="nav-item" data-view="escalas">
          <span class="nav-icon">üìã</span>
          <span>Escala</span>
        </a>
        <a href="#" class="nav-item" data-view="perfil">
          <span class="nav-icon">üë§</span>
          <span>Perfil</span>
        </a>
      </nav>
      <nav class="sidebar-nav" id="navLider" style="display: none;">
        <a href="#" class="nav-item active" data-view="checkin-ministerio">
          <span class="nav-icon">‚úÖ</span>
          <span>Check-ins do minist√©rio</span>
        </a>
        <a href="#" class="nav-item" data-view="escalas">
          <span class="nav-icon">üìã</span>
          <span>Escala</span>
        </a>
        <a href="#" class="nav-item" data-view="perfil">
          <span class="nav-icon">üë§</span>
          <span>Perfil</span>
        </a>
        <a href="#" class="nav-item" data-view="meus-checkins">
          <span class="nav-icon">üìã</span>
          <span>Meus check-ins</span>
        </a>
      </nav>
      <nav class="sidebar-nav" id="navVoluntario" style="display: none;">
        <a href="#" class="nav-item active" data-view="perfil">
          <span class="nav-icon">üë§</span>
          <span>Meu perfil</span>
        </a>
        <a href="#" class="nav-item" data-view="checkin-hoje">
          <span class="nav-icon">‚úÖ</span>
          <span>Check-in do dia</span>
        </a>
        <a href="#" class="nav-item" data-view="meus-checkins">
          <span class="nav-icon">üìã</span>
          <span>Meus check-ins</span>
        </a>
        <a href="#" class="nav-item" data-view="escalas">
          <span class="nav-icon">üìã</span>
          <span>Minhas escalas</span>
        </a>
      </nav>
      <div class="sidebar-footer">
        <div class="user-card" id="userCardGoPerfil" role="button" tabindex="0" aria-label="Ir para meu perfil">
          <div class="user-avatar" id="authUserInitial">A</div>
          <div class="user-info">
            <span class="user-name" id="authUserName"></span>
            <span class="user-role" id="authUserRole"></span>
          </div>
        </div>
        <button type="button" class="btn btn-ghost btn-block btn-sidebar-logout" id="btnLogoutSidebar" disabled>Sair</button>
      </div>
    </aside>
    <div class="sidebar-overlay" id="sidebarOverlay" aria-hidden="true"></div>

    <main class="main-content">
      <header class="top-bar">
        <button type="button" class="sidebar-toggle" id="sidebarToggle" aria-label="Abrir menu" aria-expanded="false">
          <span></span><span></span><span></span>
        </button>
        <div class="page-title">
          <h1 id="pageTitle">Volunt√°rios</h1>
          <p class="subtitle" id="pageSubtitle">Gerenciador de volunt√°rios da Igreja Celeiro S√£o Paulo.</p>
        </div>
        <div class="top-actions">
          <div class="search-box">
            <span class="search-icon">üîç</span>
            <input type="text" id="searchInput" placeholder="Buscar nome ou email...">
          </div>
        </div>
      </header>

      <div id="loading" class="loading-state">
        <div class="spinner"></div>
        <p>Carregando...</p>
      </div>

      <div id="error" class="error-state" style="display: none;">
        <p class="error-message"></p>
        <button type="button" class="btn btn-primary" id="btnRetry">Tentar novamente</button>
      </div>

      <div id="content" style="display: none;">
        <!-- Filtros (Resumo e Volunt√°rios) -->
        <section class="view active" data-view="resumo voluntarios">
          <section class="filters-row">
            <div class="filters-card">
              <div class="filters-left">
                <div class="form-group compact">
                  <label for="filterArea">√Årea</label>
                  <select id="filterArea">
                    <option value="">Todas as √°reas</option>
                  </select>
                </div>
                <div class="form-group compact">
                  <label for="filterDisponibilidade">Disponibilidade</label>
                  <select id="filterDisponibilidade"></select>
                </div>
                <div class="form-group compact">
                  <label for="filterEstado">Estado</label>
                  <select id="filterEstado"></select>
                </div>
                <div class="form-group compact">
                  <label for="filterCidade">Cidade</label>
                  <select id="filterCidade"></select>
                </div>
                <div class="form-group compact">
                  <label for="filterComCheckin">Check-in</label>
                  <select id="filterComCheckin">
                    <option value="">Todos</option>
                    <option value="com">Com check-in</option>
                    <option value="sem">Sem check-in</option>
                    <option value="so-checkin">S√≥ check-in (sem cadastro)</option>
                  </select>
                </div>
              </div>
              <div class="filters-actions">
                <button type="button" class="btn btn-primary btn-sm" id="btnRefresh">Atualizar dados</button>
                <button type="button" class="btn btn-ghost btn-sm" id="btnClearFilters">Limpar filtros</button>
              </div>
            </div>
            <div id="activeFilters" class="active-filters" style="display: none;"></div>
          </section>
          <!-- Link de cadastro (admin) -->
          <section class="cadastro-link-card filters-row" id="cadastroLinkSection" style="display: none;">
            <div class="filters-card cadastro-link-box">
              <div class="cadastro-link-content">
                <span class="cadastro-link-label">Link de cadastro:</span>
                <input type="text" id="cadastroLinkInput" class="cadastro-link-input" readonly>
                <button type="button" class="btn btn-primary btn-sm" id="btnCopiarLinkCadastro">Copiar link</button>
              </div>
            </div>
          </section>
          <!-- Verifica√ß√£o WhatsApp BR DID (admin) -->
          <section class="cadastro-link-card filters-row" id="brdidVerificacaoSection" style="display: none;">
            <div class="filters-card cadastro-link-box">
              <div class="cadastro-link-content">
                <span class="cadastro-link-label">Verifica√ß√£o WhatsApp (BR DID):</span>
                <button type="button" class="btn btn-ghost btn-sm" id="btnVerCodigoWhatsApp">Ver √∫ltimo c√≥digo</button>
                <span id="brdidCodigoResult" class="cadastro-link-label" style="margin-left:8px"></span>
              </div>
            </div>
          </section>
        </section>

        <section class="view active" data-view="resumo">
          <!-- KPIs -->
          <section class="kpi-grid">
            <div class="kpi-card">
              <div class="kpi-header">
                <span class="kpi-label">Total de inscri√ß√µes</span>
              </div>
              <div class="kpi-value" id="kpiTotal">0</div>
              <div class="kpi-footer">volunt√°rios √∫nicos (por email)</div>
            </div>
            <div class="kpi-card">
              <div class="kpi-header">
                <span class="kpi-label">√Åreas de atua√ß√£o</span>
              </div>
              <div class="kpi-value" id="kpiAreas">0</div>
              <div class="kpi-footer">tipos diferentes</div>
            </div>
            <div class="kpi-card">
              <div class="kpi-header">
                <span class="kpi-label">Selecionados</span>
              </div>
              <div class="kpi-value" id="kpiSelected">0</div>
              <div class="kpi-footer">para envio de email</div>
            </div>
            <div class="kpi-card">
              <div class="kpi-header">
                <span class="kpi-label">Com check-in</span>
              </div>
              <div class="kpi-value" id="kpiComCheckin">0</div>
              <div class="kpi-footer">j√° confirmaram presen√ßa (por email)</div>
            </div>
            <div class="kpi-card">
              <div class="kpi-header">
                <span class="kpi-label">Sem check-in</span>
              </div>
              <div class="kpi-value" id="kpiSemCheckin">0</div>
              <div class="kpi-footer">nunca confirmaram</div>
            </div>
            <div class="kpi-card">
              <div class="kpi-header">
                <span class="kpi-label">S√≥ check-in</span>
              </div>
              <div class="kpi-value" id="kpiSoCheckin">0</div>
              <div class="kpi-footer">confirmaram mas n√£o est√£o na lista</div>
            </div>
            <div class="kpi-card">
              <div class="kpi-header">
                <span class="kpi-label">Total geral</span>
              </div>
              <div class="kpi-value" id="kpiTotalGeral">0</div>
              <div class="kpi-footer">pessoas √∫nicas no sistema</div>
            </div>
          </section>

          <!-- Charts -->
          <section class="charts-row">
            <div class="chart-card chart-main">
              <div class="chart-header">
                <h2>Por √°rea de atua√ß√£o</h2>
              </div>
              <div class="chart-container">
                <canvas id="areasChart"></canvas>
              </div>
            </div>
            <div class="chart-card chart-side">
              <div class="chart-header">
                <h2>Por disponibilidade</h2>
              </div>
              <div class="chart-container chart-donut">
                <canvas id="disponibilidadeChart"></canvas>
              </div>
            </div>
          </section>

          <section class="charts-row">
            <div class="chart-card chart-main">
              <div class="chart-header">
                <h2>Por estado</h2>
              </div>
              <div class="chart-container">
                <canvas id="estadoChart"></canvas>
              </div>
            </div>
            <div class="chart-card chart-side">
              <div class="chart-header">
                <h2>Por cidade</h2>
              </div>
              <div class="chart-container">
                <canvas id="cidadeChart"></canvas>
              </div>
            </div>
          </section>
        </section>

        <!-- Volunt√°rios: lista + envio de email -->
        <section class="view" data-view="voluntarios">
          <section class="table-section">
            <div class="table-card">
              <div class="chart-header">
                <h2>Volunt√°rios <span id="voluntariosCountTop" class="list-count">(0)</span></h2>
                <div class="table-actions">
                  <label class="checkbox-label">
                    <input type="checkbox" id="selectAll" title="Selecionar todos da filtragem">
                    <span>Selecionar todos</span>
                  </label>
                  <button type="button" class="btn btn-primary btn-sm" id="btnOpenSend">
                    ‚úâÔ∏è Enviar email (<span id="countSelected">0</span>)
                  </button>
                </div>
              </div>
              <div class="table-wrapper">
                <table class="data-table" id="voluntariosTable">
                  <thead>
                    <tr>
                      <th class="col-check"><input type="checkbox" id="selectAllHeader" title="Selecionar todos da filtragem"></th>
                      <th>Nome</th>
                      <th>Email</th>
                      <th>Cidade / Estado</th>
                      <th>√Åreas</th>
                      <th>Disponibilidade</th>
                    </tr>
                  </thead>
                  <tbody id="voluntariosBody">
                  </tbody>
                </table>
              </div>
              <div class="table-footer">
                <span id="tableCount">0</span> volunt√°rios
                <span id="voluntariosRange" class="list-range"></span>
                <button type="button" class="btn btn-ghost btn-sm" id="btnVerMaisVoluntarios" style="display: none;">Ver mais</button>
              </div>
            </div>
          </section>
        </section>

        <!-- Minist√©rios (admin) -->
        <section class="view" data-view="ministros">
          <section class="filters-row">
            <div class="filters-card">
              <button type="button" class="btn btn-primary" id="btnNovoMinisterio">‚ûï Novo minist√©rio</button>
            </div>
          </section>
          <div class="table-card">
            <div class="chart-header"><h2>Minist√©rios</h2></div>
            <p class="auth-subtitle">Crie minist√©rios e defina l√≠deres. <span id="ministrosCount" class="list-count">(0)</span></p>
            <div class="table-wrapper">
              <table class="data-table">
                <thead><tr><th>Nome</th><th>L√≠der</th><th>A√ß√£o</th></tr></thead>
                <tbody id="ministrosBody"></tbody>
              </table>
            </div>
          </div>
          <div id="modalNovoMinisterio" class="modal" aria-hidden="true">
            <div class="modal-backdrop"></div>
            <div class="modal-box">
              <div class="modal-header"><h2>Novo minist√©rio</h2><button type="button" class="modal-close" id="modalNovoMinisterioClose">&times;</button></div>
              <form id="formNovoMinisterio" class="modal-body">
                <div class="form-group"><label for="ministerioNome">Nome</label><input type="text" id="ministerioNome" placeholder="Ex: Louvor" required></div>
                <div class="modal-footer"><button type="button" class="btn btn-ghost" id="modalNovoMinisterioCancel">Cancelar</button><button type="submit" class="btn btn-primary">Criar</button></div>
              </form>
            </div>
          </div>
          <div id="modalEditarMinisterio" class="modal" aria-hidden="true">
            <div class="modal-backdrop"></div>
            <div class="modal-box">
              <div class="modal-header"><h2>Editar minist√©rio</h2><button type="button" class="modal-close" id="modalEditarMinisterioClose">&times;</button></div>
              <form id="formEditarMinisterio" class="modal-body">
                <input type="hidden" id="editarMinisterioId" value="">
                <div class="form-group"><label for="editarMinisterioNome">Nome</label><input type="text" id="editarMinisterioNome" placeholder="Ex: Louvor" required></div>
                <div class="modal-footer"><button type="button" class="btn btn-ghost" id="modalEditarMinisterioCancel">Cancelar</button><button type="submit" class="btn btn-primary">Salvar</button></div>
              </form>
            </div>
          </div>
          <div id="modalAssignLider" class="modal" aria-hidden="true">
            <div class="modal-backdrop"></div>
            <div class="modal-box">
              <div class="modal-header"><h2>Definir l√≠deres do minist√©rio</h2><button type="button" class="modal-close" id="modalAssignLiderClose">&times;</button></div>
              <div class="modal-body">
                <p class="auth-subtitle" id="assignLiderMinisterioNome"></p>
                <div class="form-group">
                  <label class="block-label">Buscar volunt√°rio por email</label>
                  <div style="display:flex;gap:8px;align-items:flex-end;flex-wrap:wrap">
                    <input type="email" id="assignLiderSearchEmail" placeholder="email@exemplo.com" style="flex:1;min-width:180px">
                    <button type="button" class="btn btn-primary" id="btnAssignLiderSearch">Buscar</button>
                  </div>
                  <p id="assignLiderSearchMsg" class="form-hint" style="margin-top:6px"></p>
                </div>
                <div class="form-group" id="assignLiderCheckboxesWrap">
                  <label class="block-label">Selecione um ou mais l√≠deres</label>
                  <div id="assignLiderCheckboxes"></div>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-ghost" id="modalAssignLiderCancel">Cancelar</button><button type="button" class="btn btn-primary" id="btnAssignLider">Salvar l√≠deres</button></div>
              </div>
            </div>
          </div>
        </section>

        <!-- Usu√°rios e perfis (admin) -->
        <section class="view" data-view="usuarios">
          <div class="table-card">
            <div class="chart-header" style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px">
              <h2>Usu√°rios e perfis</h2>
              <button type="button" class="btn btn-primary" id="btnCriarUsuario">‚ûï Criar usu√°rio</button>
            </div>
            <div class="filters-row" style="margin-bottom:12px">
              <div class="filters-card">
                <div class="filters-left">
                  <div class="form-group compact">
                    <label for="usuariosSearch">Buscar</label>
                    <input type="text" id="usuariosSearch" placeholder="Nome ou email">
                  </div>
                  <div class="form-group compact">
                    <label for="usuariosFilterAtivo">Status</label>
                    <select id="usuariosFilterAtivo">
                      <option value="">Todos</option>
                      <option value="true">Ativos</option>
                      <option value="false">Inativos</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
            <p class="auth-subtitle">Perfis e permiss√µes. <span id="usuariosCount" class="list-count">(0)</span></p>
            <div class="table-wrapper">
              <table class="data-table">
                <thead><tr><th>Nome</th><th>Email</th><th>Perfil</th><th>Minist√©rio</th><th>Status</th><th>A√ß√£o</th></tr></thead>
                <tbody id="usuariosBody"></tbody>
              </table>
            </div>
          </div>
          <div id="modalUserRole" class="modal" aria-hidden="true">
            <div class="modal-backdrop"></div>
            <div class="modal-box">
              <div class="modal-header"><h2>Alterar perfil</h2><button type="button" class="modal-close" id="modalUserRoleClose">&times;</button></div>
              <div class="modal-body" id="modalUserRoleFormBody">
                <p class="auth-subtitle" id="modalUserRoleEmail"></p>
                <div class="form-group"><label for="userRoleSelect">Perfil</label><select id="userRoleSelect"><option value="voluntario">Volunt√°rio</option><option value="admin">Admin</option><option value="lider">L√≠der de minist√©rio</option></select></div>
                <div class="form-group" id="userMinisterioGroup" style="display: none;"><label class="block-label">Minist√©rios (l√≠der pode ter v√°rios; admin tamb√©m)</label><div id="userMinisterioCheckboxes"></div></div>
                <div class="modal-footer"><button type="button" class="btn btn-ghost" id="modalUserRoleCancel">Cancelar</button><button type="button" class="btn btn-primary" id="btnSaveUserRole">Salvar</button></div>
              </div>
              <div class="modal-body" id="modalUserHistoryBody" style="display: none;">
                <h3>Hist√≥rico de perfil</h3>
                <ul id="userHistoryList"></ul>
                <button type="button" class="btn btn-ghost btn-sm" id="btnUserRoleBack">Voltar</button>
              </div>
            </div>
          </div>
          <div id="modalCriarUsuario" class="modal" aria-hidden="true">
            <div class="modal-backdrop"></div>
            <div class="modal-box">
              <div class="modal-header"><h2>Criar usu√°rio</h2><button type="button" class="modal-close" id="modalCriarUsuarioClose">&times;</button></div>
              <form id="formCriarUsuario" class="modal-body">
                <p id="criarUsuarioError" class="form-error" role="alert" style="display:none; margin-bottom:12px;"></p>
                <div class="form-group"><label for="criarUsuarioEmail">Email</label><input type="email" id="criarUsuarioEmail" placeholder="usuario@exemplo.com" required></div>
                <div class="form-group"><label for="criarUsuarioNome">Nome</label><input type="text" id="criarUsuarioNome" placeholder="Nome completo" required></div>
                <div class="form-group"><label for="criarUsuarioSenha">Senha tempor√°ria</label><input type="password" id="criarUsuarioSenha" placeholder="M√≠nimo 6 caracteres" minlength="6" required autocomplete="new-password"></div>
                <p class="form-hint">O usu√°rio dever√° trocar a senha no primeiro acesso.</p>
                <div class="form-group"><label for="criarUsuarioRole">Perfil</label><select id="criarUsuarioRole"><option value="voluntario">Volunt√°rio</option><option value="admin">Admin</option><option value="lider">L√≠der de minist√©rio</option></select></div>
                <div class="form-group" id="criarUsuarioMinisterioGroup" style="display: none;"><label class="block-label">Minist√©rios</label><div id="criarUsuarioMinisterioCheckboxes"></div></div>
                <div class="modal-footer"><button type="button" class="btn btn-ghost" id="modalCriarUsuarioCancel">Cancelar</button><button type="submit" class="btn btn-primary">Criar</button></div>
              </form>
            </div>
          </div>
        </section>

        <!-- Eventos de check-in (admin) -->
        <section class="view" data-view="eventos-checkin">
          <section class="filters-row">
            <div class="filters-card">
              <button type="button" class="btn btn-primary" id="btnNovoEvento">‚ûï Novo evento de check-in</button>
            </div>
          </section>
          <div id="eventosCheckinList" class="table-card">
            <div class="chart-header"><h2>Eventos de check-in</h2></div>
            <p class="auth-subtitle">Datas de culto para check-in. <span id="eventosCheckinCount" class="list-count">(0)</span></p>
            <div class="table-wrapper">
              <table class="data-table">
                <thead><tr><th>Data</th><th>Nome</th><th>Hor√°rio (SP)</th><th>Status</th><th>Link p√∫blico</th><th>A√ß√£o</th></tr></thead>
                <tbody id="eventosCheckinBody"></tbody>
              </table>
            </div>
            <p class="form-hint" style="margin-top:8px">Use o bot√£o "Copiar link" na coluna <strong>Link p√∫blico</strong> para compartilhar: qualquer pessoa pode abrir o link, informar email e minist√©rio e fazer o check-in (sem precisar de conta).</p>
          </div>
          <div id="modalNovoEvento" class="modal" aria-hidden="true">
            <div class="modal-backdrop"></div>
            <div class="modal-box">
              <div class="modal-header"><h2>Novo evento de check-in</h2><button type="button" class="modal-close" id="modalNovoEventoClose">&times;</button></div>
              <form id="formNovoEvento" class="modal-body">
                <div class="form-group"><label for="eventoData">Data do culto</label><input type="date" id="eventoData" required></div>
                <div class="form-group"><label for="eventoLabel">Nome (opcional)</label><input type="text" id="eventoLabel" placeholder="Ex: Culto 09/02"></div>
                <div class="form-row form-row-2">
                  <div class="form-group"><label for="eventoHorarioInicio">In√≠cio do check-in</label><input type="time" id="eventoHorarioInicio" step="300" placeholder="00:00"></div>
                  <div class="form-group"><label for="eventoHorarioFim">Fim do check-in</label><input type="time" id="eventoHorarioFim" step="300" placeholder="23:59"></div>
                </div>
                <p class="form-hint">Hor√°rios em hor√°rio de S√£o Paulo. Deixe em branco para permitir check-in o dia todo.</p>
                <div class="form-group">
                  <label class="checkbox-label">
                    <input type="checkbox" id="eventoAtivo" checked>
                    Check-in ativo (volunt√°rios poder√£o realizar check-in neste dia)
                  </label>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-ghost" id="modalNovoEventoCancel">Cancelar</button><button type="submit" class="btn btn-primary">Criar</button></div>
              </form>
            </div>
          </div>
          <div id="modalEditarEvento" class="modal" aria-hidden="true">
            <div class="modal-backdrop"></div>
            <div class="modal-box">
              <div class="modal-header"><h2>Editar evento de check-in</h2><button type="button" class="modal-close" id="modalEditarEventoClose">&times;</button></div>
              <form id="formEditarEvento" class="modal-body">
                <input type="hidden" id="editarEventoId" value="">
                <div class="form-group"><label for="editarEventoLabel">Nome</label><input type="text" id="editarEventoLabel" placeholder="Ex: Culto 09/02"></div>
                <div class="form-row form-row-2">
                  <div class="form-group"><label for="editarEventoHorarioInicio">In√≠cio do check-in</label><input type="time" id="editarEventoHorarioInicio" step="300"></div>
                  <div class="form-group"><label for="editarEventoHorarioFim">Fim do check-in</label><input type="time" id="editarEventoHorarioFim" step="300"></div>
                </div>
                <p class="form-hint">Hor√°rios em hor√°rio de S√£o Paulo. Deixe em branco para permitir check-in o dia todo.</p>
                <div class="form-group">
                  <label class="checkbox-label">
                    <input type="checkbox" id="editarEventoAtivo" checked>
                    Check-in ativo (ligar/desligar)
                  </label>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-ghost" id="modalEditarEventoCancel">Cancelar</button><button type="submit" class="btn btn-primary">Salvar</button></div>
              </form>
            </div>
          </div>
        </section>

        <!-- Check-in (admin) -->
        <section class="view" data-view="checkin">
          <section class="filters-row">
            <div class="filters-card">
              <div class="filters-left">
                <div class="form-group compact">
                  <label for="checkinData">Data</label>
                  <select id="checkinData">
                    <option value="">Todas as datas</option>
                  </select>
                </div>
                <div class="form-group compact">
                  <label for="checkinEvento">Evento</label>
                  <select id="checkinEvento"></select>
                </div>
                <div class="form-group compact">
                  <label for="checkinMinisterio">Minist√©rio</label>
                  <select id="checkinMinisterio"></select>
                </div>
                <div class="form-group compact">
                  <label for="checkinSearch">Buscar</label>
                  <input type="text" id="checkinSearch" placeholder="Nome ou email">
                </div>
                <div class="form-group compact">
                  <label for="checkinQtdCheckins">Qtd. check-ins</label>
                  <select id="checkinQtdCheckins">
                    <option value="">Qualquer qtd.</option>
                  </select>
                </div>
              </div>
              <div class="filters-actions">
                <button type="button" class="btn btn-ghost btn-sm" id="btnClearCheckinFilters">Limpar filtros</button>
              </div>
            </div>
          </section>

          <section class="kpi-grid">
            <div class="kpi-card">
              <div class="kpi-header">
                <span class="kpi-label">Total de check-ins</span>
              </div>
              <div class="kpi-value" id="checkinTotal">0</div>
              <div class="kpi-footer">registros no banco</div>
            </div>
            <div class="kpi-card">
              <div class="kpi-header">
                <span class="kpi-label">Minist√©rios</span>
              </div>
              <div class="kpi-value" id="checkinMinisterios">0</div>
              <div class="kpi-footer">diferentes</div>
            </div>
            <div class="kpi-card">
              <div class="kpi-header">
                <span class="kpi-label">Hoje</span>
              </div>
              <div class="kpi-value" id="checkinHoje">0</div>
              <div class="kpi-footer">check-ins</div>
            </div>
          </section>

          <section class="charts-row">
            <div class="chart-card chart-main">
              <div class="chart-header">
                <h2>Por minist√©rio</h2>
              </div>
              <div class="chart-container">
                <canvas id="ministerioChart"></canvas>
              </div>
            </div>
            <div class="chart-card chart-side">
              <div class="chart-header">
                <h2>Lista de check-ins</h2>
              </div>
              <div class="table-wrapper">
                <table class="data-table">
                  <thead>
                    <tr>
                      <th>Nome</th>
                      <th>Email</th>
                      <th>Minist√©rio</th>
                      <th>Data/Hora</th>
                    </tr>
                  </thead>
                  <tbody id="checkinBody"></tbody>
                </table>
              </div>
              <div class="table-footer">
                <span id="checkinCount">0</span> check-ins <span id="checkinRange" class="list-range"></span>
              </div>
            </div>
          </section>

          <section class="dados-incompletos-section" id="dadosIncompletosSection" style="display:none">
            <div class="filters-card">
              <div class="dados-incompletos-header">
                <div>
                  <h3 id="dadosIncompletosTitle">Dados incompletos</h3>
                  <p class="dados-incompletos-sub">Volunt√°rios que fizeram check-in mas n√£o criaram conta na plataforma</p>
                </div>
                <div class="dados-incompletos-actions">
                  <span id="dadosIncompletosStatus" class="dados-incompletos-status"></span>
                  <button type="button" class="btn btn-primary btn-sm" id="btnEnviarEmailIncompletos">Enviar email de cadastro</button>
                </div>
              </div>
              <div class="table-wrapper" style="margin-top:16px">
                <table class="data-table">
                  <thead>
                    <tr>
                      <th>Nome</th>
                      <th>Email</th>
                    </tr>
                  </thead>
                  <tbody id="dadosIncompletosBody"></tbody>
                </table>
              </div>
            </div>
          </section>
        </section>

        <!-- Criar escalas (admin only) -->
        <section class="view" data-view="escalas-criar">
          <div id="escalasCriarContent"><!-- renderizado por JS --></div>
        </section>
        <!-- Escala: candidatos (admin/lider) ou minhas escalas (voluntario) -->
        <section class="view" data-view="escalas">
          <div id="escalasContent"><!-- renderizado por JS --></div>
        </section>

        <!-- Volunt√°rio / L√≠der / Admin: tela de perfil -->
        <section class="view" data-view="perfil">
          <div class="perfil-page">
            <div class="filters-card perfil-card">
              <div class="perfil-form-header">
                <h2 class="perfil-title">Atualizar dados de perfil</h2>
                <p class="auth-subtitle">Atualize seus dados de cadastro.</p>
              </div>
              <form id="formPerfil" class="auth-form perfil-form">
                <div class="form-row">
                  <div class="form-group"><label for="perfilNome">Nome completo</label><input type="text" id="perfilNome" placeholder="Nome completo"></div>
                  <div class="form-group"><label for="perfilEmail">Email</label><input type="email" id="perfilEmail" placeholder="seu@email.com" disabled></div>
                </div>
                <div class="form-row">
                  <div class="form-group"><label for="perfilNascimento">Data de nascimento</label><input type="date" id="perfilNascimento" min="1920-01-01" max="2015-12-31" title="Data v√°lida entre 1920 e 2015"></div>
                  <div class="form-group"><label for="perfilWhatsapp">WhatsApp</label><input type="tel" id="perfilWhatsapp" placeholder="(11) 99999-9999" maxlength="16" inputmode="numeric" pattern="[0-9\s\(\)\-]+" title="Apenas n√∫meros. Ex: (11) 99999-9999"></div>
                </div>
                <div class="form-row">
                  <div class="form-group"><label for="perfilPais">Pa√≠s</label><input type="text" id="perfilPais" placeholder="Brasil"></div>
                  <div class="form-group"><label for="perfilEstado">Estado (UF)</label><select id="perfilEstado"><option value="">Selecione</option></select></div>
                  <div class="form-group"><label for="perfilCidade">Cidade</label><input type="text" id="perfilCidade" placeholder="Cidade"></div>
                </div>
                <div class="form-group"><label for="perfilEvangelico">√â crist√£o/evang√©lico?</label><select id="perfilEvangelico"><option value="">Selecione</option><option value="Sim">Sim</option><option value="N√£o">N√£o</option></select></div>
                <div class="form-group"><label for="perfilIgreja">Igreja onde congrega</label><input type="text" id="perfilIgreja" placeholder="Nome da igreja"></div>
                <div class="form-row">
                  <div class="form-group"><label for="perfilTempoIgreja">Tempo na igreja</label><select id="perfilTempoIgreja"><option value="">Selecione</option><option value="Menos de 1 ano">Menos de 1 ano</option><option value="1 a 3 anos">1 a 3 anos</option><option value="3 a 5 anos">3 a 5 anos</option><option value="5 a 10 anos">5 a 10 anos</option><option value="Mais de 10 anos">Mais de 10 anos</option><option value="N√£o frequento">N√£o frequento</option></select></div>
                  <div class="form-group"><label for="perfilVoluntarioIgreja">J√° √© volunt√°rio na igreja?</label><select id="perfilVoluntarioIgreja"><option value="">Selecione</option><option value="Sim">Sim</option><option value="N√£o">N√£o</option></select></div>
                </div>
                <div class="form-group"><label for="perfilMinisterio">Minist√©rio</label><select id="perfilMinisterio"><option value="">Selecione</option></select><input type="text" id="perfilMinisterioOutro" placeholder="Outro (especifique)" class="ministerio-outro-input" style="display:none"></div>
                <div class="form-group">
                  <label>Disponibilidade</label>
                  <p class="form-hint">Em quais dias da semana voc√™ est√° dispon√≠vel?</p>
                  <div id="perfilDisponibilidadeGroup" class="disponibilidade-dias" role="group" aria-label="Dias da semana">
                    <label class="checkbox-label"><input type="checkbox" name="perfilDisponibilidadeDia" value="Segunda"> Segunda</label>
                    <label class="checkbox-label"><input type="checkbox" name="perfilDisponibilidadeDia" value="Ter√ßa"> Ter√ßa</label>
                    <label class="checkbox-label"><input type="checkbox" name="perfilDisponibilidadeDia" value="Quarta"> Quarta</label>
                    <label class="checkbox-label"><input type="checkbox" name="perfilDisponibilidadeDia" value="Quinta"> Quinta</label>
                    <label class="checkbox-label"><input type="checkbox" name="perfilDisponibilidadeDia" value="Sexta"> Sexta</label>
                    <label class="checkbox-label"><input type="checkbox" name="perfilDisponibilidadeDia" value="S√°bado"> S√°bado</label>
                    <label class="checkbox-label"><input type="checkbox" name="perfilDisponibilidadeDia" value="Domingo"> Domingo</label>
                  </div>
                </div>
                <div class="form-group"><label for="perfilHorasSemana">Horas/semana</label><select id="perfilHorasSemana"><option value="">Selecione</option><option value="At√© 2 horas">At√© 2 horas</option><option value="2 a 4 horas">2 a 4 horas</option><option value="4 a 6 horas">4 a 6 horas</option><option value="6 a 10 horas">6 a 10 horas</option><option value="Mais de 10 horas">Mais de 10 horas</option></select></div>
                <div class="form-group"><label for="perfilAreas">√Åreas de interesse</label><input type="text" id="perfilAreas" placeholder="Ex: M√≠dia, Louvor"></div>
                <div class="form-group"><label for="perfilTestemunho">Testemunho</label><p class="form-hint">Preencha o testemunho de como sua vida foi mudada atrav√©s de Jesus (n√£o obrigat√≥rio).</p><textarea id="perfilTestemunho" placeholder="Conte um pouco da sua hist√≥ria com Jesus..." rows="4"></textarea></div>
                <button type="submit" class="btn btn-primary">Salvar</button>
              </form>
            </div>
          </div>
        </section>

        <!-- Volunt√°rio: Realizar check-in do dia -->
        <section class="view" data-view="checkin-hoje">
          <div class="checkin-hoje-card">
            <h2>Realizar check-in do dia</h2>
            <p class="checkin-hoje-subtitle">Confirme presen√ßa no culto de hoje.</p>
            <div id="eventosHojeList" class="checkin-hoje-eventos"></div>
            <div id="formConfirmarCheckin" class="checkin-hoje-form" style="display: none;">
              <div class="form-group"><label for="confirmarMinisterio">Minist√©rio</label><select id="confirmarMinisterio"><option value="">Selecione</option></select></div>
              <button type="button" class="btn btn-primary" id="btnConfirmarCheckin">Confirmar presen√ßa</button>
            </div>
          </div>
        </section>

        <!-- Volunt√°rio: Hist√≥rico pr√≥prio de check-ins -->
        <section class="view" data-view="meus-checkins">
          <p id="checkinRecebidoMsg" class="checkin-recebido-msg" style="display: none;" role="status"></p>
          <div class="table-card">
            <div class="chart-header"><h2>Meus check-ins <span id="meusCheckinsCount" class="list-count">(0)</span></h2></div>
            <div class="table-wrapper">
              <table class="data-table">
                <thead><tr><th>Data</th><th>Minist√©rio</th><th>Hor√°rio</th></tr></thead>
                <tbody id="meusCheckinsBody"></tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- L√≠der: Check-ins do minist√©rio (quem confirmou presen√ßa no minist√©rio) -->
        <section class="view" data-view="checkin-ministerio">
          <section class="filters-row">
            <div class="filters-card">
              <div class="filters-left">
                <div class="form-group compact">
                  <label for="checkinMinisterioData">Data</label>
                  <select id="checkinMinisterioData"></select>
                </div>
              </div>
              <div class="filters-actions">
                <button type="button" class="btn btn-ghost btn-sm" id="btnRefreshCheckinMinisterio">Atualizar</button>
              </div>
            </div>
          </section>
          <section class="kpi-grid">
            <div class="kpi-card">
              <div class="kpi-header"><span class="kpi-label">Total</span></div>
              <div class="kpi-value" id="checkinMinisterioTotal">0</div>
              <div class="kpi-footer">volunt√°rios que confirmaram presen√ßa</div>
            </div>
          </section>
          <section class="charts-row">
            <div class="table-card chart-main">
              <div class="chart-header"><h2>Quem confirmou presen√ßa no seu minist√©rio <span id="checkinMinisterioCount" class="list-count">(0)</span></h2></div>
              <div class="table-wrapper">
                <table class="data-table">
                  <thead><tr><th>Nome</th><th>Email</th><th>Minist√©rio</th><th>Data/Hora</th></tr></thead>
                  <tbody id="checkinMinisterioBody"></tbody>
                </table>
              </div>
            </div>
          </section>
        </section>

      </div>
    </main>
  </div>

  <!-- Check-in p√∫blico por link (sem login) -->
  <!-- Candidatura p√∫blica por link de escala -->
  <div id="escalaPublicOverlay" class="auth-overlay" style="display: none;">
    <div class="auth-card checkin-public-card">
      <div class="auth-header">
        <div class="logo"><span class="logo-icon">‚óá</span><span class="logo-text">Celeiro SP</span></div>
        <p class="auth-subtitle" id="escalaPublicSubtitle">Candidatura para escala</p>
      </div>
      <form id="escalaPublicForm" class="auth-form">
        <p class="form-hint" id="escalaPublicLabel" style="margin-bottom:12px;font-size:1rem;font-weight:600;color:var(--text-primary)"></p>
        <div class="form-group">
          <label for="escalaPublicNome">Nome completo</label>
          <input type="text" id="escalaPublicNome" placeholder="Seu nome completo" required autocomplete="name">
        </div>
        <div class="form-group">
          <label for="escalaPublicEmail">Email</label>
          <input type="email" id="escalaPublicEmail" placeholder="seu@email.com" required autocomplete="email">
        </div>
        <div class="form-group">
          <label for="escalaPublicTelefone">Telefone / WhatsApp</label>
          <input type="tel" id="escalaPublicTelefone" placeholder="(11) 99999-9999" autocomplete="tel">
        </div>
        <div class="form-group">
          <label for="escalaPublicMinisterio">Minist√©rio</label>
          <select id="escalaPublicMinisterio" required aria-label="Selecione o minist√©rio">
            <option value="">Selecione o minist√©rio</option>
            <option value="Suporte Geral">Suporte Geral</option>
            <option value="Welcome / Recep√ß√£o">Welcome / Recep√ß√£o</option>
            <option value="Experience / Audit√≥rio">Experience / Audit√≥rio</option>
            <option value="Streaming / Ao Vivo">Streaming / Ao Vivo</option>
            <option value="Produ√ß√£o Ao Vivo">Produ√ß√£o Ao Vivo</option>
            <option value="Lab / M√≠dia">Lab / M√≠dia</option>
            <option value="Produ√ß√£o">Produ√ß√£o</option>
            <option value="Intercess√£o Presencial">Intercess√£o Presencial</option>
            <option value="Sala de Volunt√°rios">Sala de Volunt√°rios</option>
            <option value="Kids / Min. Infantil">Kids / Min. Infantil</option>
            <option value="Consolida√ß√£o">Consolida√ß√£o</option>
            <option value="Care / Sa√∫de">Care / Sa√∫de</option>
            <option value="Parking / Estacionamento">Parking / Estacionamento</option>
            <option value="Seguran√ßa">Seguran√ßa</option>
            <option value="Intercess√£o Online">Intercess√£o Online</option>
          </select>
        </div>
        <p id="escalaPublicError" class="auth-error"></p>
        <p id="escalaPublicSuccess" class="auth-success" style="display:none;"></p>
        <button type="submit" class="btn btn-primary" id="btnEscalaPublicSubmit">Me candidatar</button>
      </form>
      <div id="escalaPublicSuccessWrap" style="display:none;">
        <p class="auth-success" style="margin-bottom:16px;">Candidatura registrada com sucesso! Aguarde a aprova√ß√£o do l√≠der do seu minist√©rio.</p>
        <button type="button" class="btn btn-primary" id="btnEscalaPublicVerMinhas">Ver minhas escalas</button>
      </div>
    </div>
  </div>

  <div id="checkinPublicOverlay" class="auth-overlay" style="display: none;">
    <div class="auth-card checkin-public-card">
      <div class="auth-header">
        <div class="logo"><span class="logo-icon">‚óá</span><span class="logo-text">Celeiro SP</span></div>
        <p class="auth-subtitle" id="checkinPublicSubtitle">Check-in de presen√ßa</p>
      </div>
      <form id="checkinPublicForm" class="auth-form">
        <p class="form-hint" id="checkinPublicEventLabel" style="margin-bottom:4px"></p>
        <p class="form-hint" id="checkinPublicEventHorario" style="margin-bottom:12px;font-size:0.9em"></p>
        <div class="form-group">
          <label for="checkinPublicEmail">Email</label>
          <input type="email" id="checkinPublicEmail" placeholder="seu@email.com" required autocomplete="email">
        </div>
        <div class="form-group">
          <label for="checkinPublicNome">Nome (opcional)</label>
          <input type="text" id="checkinPublicNome" placeholder="Seu nome">
        </div>
        <div class="form-group">
          <label for="checkinPublicMinisterio">Minist√©rio</label>
          <select id="checkinPublicMinisterio">
            <option value="">Selecione</option>
            <option value="Suporte Geral">Suporte Geral</option>
            <option value="Welcome / Recep√ß√£o">Welcome / Recep√ß√£o</option>
            <option value="Experience / Audit√≥rio">Experience / Audit√≥rio</option>
            <option value="Streaming / Ao Vivo">Streaming / Ao Vivo</option>
            <option value="Produ√ß√£o Ao Vivo">Produ√ß√£o Ao Vivo</option>
            <option value="Lab / M√≠dia">Lab / M√≠dia</option>
            <option value="Produ√ß√£o">Produ√ß√£o</option>
            <option value="Intercess√£o Presencial">Intercess√£o Presencial</option>
            <option value="Sala de Volunt√°rios">Sala de Volunt√°rios</option>
            <option value="Kids / Min. Infantil">Kids / Min. Infantil</option>
            <option value="Consolida√ß√£o">Consolida√ß√£o</option>
            <option value="Care / Sa√∫de">Care / Sa√∫de</option>
            <option value="Parking / Estacionamento">Parking / Estacionamento</option>
            <option value="Seguran√ßa">Seguran√ßa</option>
            <option value="Intercess√£o Online">Intercess√£o Online</option>
          </select>
        </div>
        <p id="checkinPublicError" class="auth-error"></p>
        <p id="checkinPublicSuccess" class="auth-success" style="display: none;"></p>
        <button type="submit" class="btn btn-primary" id="btnCheckinPublicSubmit">Confirmar check-in</button>
      </form>
    </div>
  </div>

  <!-- Cadastro p√∫blico de volunt√°rios (link compartilh√°vel) -->
  <div id="cadastroOverlay" class="auth-overlay cadastro-overlay" style="display: none;">
    <div class="auth-card cadastro-card">
      <div class="auth-header">
        <div class="logo"><span class="logo-icon">‚óá</span><span class="logo-text">Celeiro SP</span></div>
        <p class="auth-subtitle">Inscri√ß√£o de volunt√°rios</p>
      </div>
      <form id="cadastroPublicoForm" class="auth-form cadastro-form">
        <div class="form-row">
          <div class="form-group"><label for="cadastroNome">Nome completo</label><input type="text" id="cadastroNome" placeholder="Seu nome completo" required></div>
          <div class="form-group"><label for="cadastroEmail">Email</label><input type="email" id="cadastroEmail" placeholder="seu@email.com" required></div>
        </div>
        <div class="form-row">
          <div class="form-group"><label for="cadastroNascimento">Data de nascimento</label><input type="date" id="cadastroNascimento" min="1920-01-01" max="2015-12-31" title="Data v√°lida entre 1920 e 2015"></div>
          <div class="form-group"><label for="cadastroWhatsapp">WhatsApp</label><input type="tel" id="cadastroWhatsapp" placeholder="(11) 99999-9999" maxlength="16" inputmode="numeric" pattern="[0-9\s\(\)\-]+" title="Apenas n√∫meros. Ex: (11) 99999-9999"></div>
        </div>
        <div class="form-row">
          <div class="form-group"><label for="cadastroPais">Pa√≠s</label><input type="text" id="cadastroPais" placeholder="Brasil"></div>
          <div class="form-group"><label for="cadastroEstado">Estado (UF)</label><select id="cadastroEstado"><option value="">Selecione</option></select></div>
          <div class="form-group"><label for="cadastroCidade">Cidade</label><input type="text" id="cadastroCidade" placeholder="Cidade"></div>
        </div>
        <div class="form-group"><label for="cadastroEvangelico">√â crist√£o/evang√©lico?</label><select id="cadastroEvangelico"><option value="">Selecione</option><option value="Sim">Sim</option><option value="N√£o">N√£o</option></select></div>
        <div class="form-group"><label for="cadastroIgreja">Igreja onde congrega</label><input type="text" id="cadastroIgreja" placeholder="Nome da igreja"></div>
        <div class="form-row">
          <div class="form-group"><label for="cadastroTempoIgreja">Tempo na igreja</label><select id="cadastroTempoIgreja"><option value="">Selecione</option><option value="Menos de 1 ano">Menos de 1 ano</option><option value="1 a 3 anos">1 a 3 anos</option><option value="3 a 5 anos">3 a 5 anos</option><option value="5 a 10 anos">5 a 10 anos</option><option value="Mais de 10 anos">Mais de 10 anos</option><option value="N√£o frequento">N√£o frequento</option></select></div>
          <div class="form-group"><label for="cadastroVoluntarioIgreja">J√° √© volunt√°rio na igreja?</label><select id="cadastroVoluntarioIgreja"><option value="">Selecione</option><option value="Sim">Sim</option><option value="N√£o">N√£o</option></select></div>
        </div>
        <div class="form-group"><label for="cadastroMinisterio">Minist√©rio</label><select id="cadastroMinisterio"><option value="">Selecione</option></select><input type="text" id="cadastroMinisterioOutro" placeholder="Outro (especifique)" class="ministerio-outro-input" style="display:none"></div>
        <div class="form-group"><label for="cadastroDisponibilidade">Disponibilidade</label><select id="cadastroDisponibilidade"><option value="">Selecione</option><option value="Domingos manh√£">Domingos manh√£</option><option value="Domingos noite">Domingos noite</option><option value="S√°bados">S√°bados</option><option value="Durante a semana">Durante a semana</option><option value="Finais de semana">Finais de semana</option><option value="Conforme necessidade">Conforme necessidade</option><option value="Outro">Outro</option></select></div>
        <div class="form-group"><label for="cadastroHorasSemana">Horas/semana</label><select id="cadastroHorasSemana"><option value="">Selecione</option><option value="At√© 2 horas">At√© 2 horas</option><option value="2 a 4 horas">2 a 4 horas</option><option value="4 a 6 horas">4 a 6 horas</option><option value="6 a 10 horas">6 a 10 horas</option><option value="Mais de 10 horas">Mais de 10 horas</option></select></div>
        <div class="form-group"><label for="cadastroAreas">√Åreas de interesse</label><input type="text" id="cadastroAreas" placeholder="Ex: M√≠dia, Louvor"></div>
        <div class="form-group"><label for="cadastroTestemunho">Testemunho</label><p class="form-hint">Preencha o testemunho de como sua vida foi mudada atrav√©s de Jesus (n√£o obrigat√≥rio).</p><textarea id="cadastroTestemunho" placeholder="Conte um pouco da sua hist√≥ria com Jesus..." rows="4"></textarea></div>
        <p id="cadastroPublicoError" class="auth-error"></p>
        <p id="cadastroPublicoSuccess" class="auth-success" style="display: none;"></p>
        <button type="submit" class="btn btn-primary" id="btnCadastroPublico">Enviar inscri√ß√£o</button>
      </form>
      <p class="auth-footer-link"><a href="#" id="linkSairCadastro">Voltar ao login</a></p>
    </div>
  </div>

  <!-- Login -->
  <div id="authOverlay" class="auth-overlay" style="display: none;">
    <div class="auth-card" id="loginCard">
      <div class="auth-header">
        <div class="logo">
          <span class="logo-icon">‚óá</span>
          <span class="logo-text">Celeiro SP</span>
        </div>
        <p class="auth-subtitle">Use email ou usu√°rio admin.</p>
      </div>
      <form id="loginForm" class="auth-form">
        <div class="form-group">
          <label for="loginEmail">Email ou usu√°rio</label>
          <input type="text" id="loginEmail" autocomplete="username" placeholder="admin ou seu@email.com">
        </div>
        <div class="form-group">
          <label for="loginPass">Senha</label>
          <input type="password" id="loginPass" autocomplete="current-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
        </div>
        <p id="loginError" class="auth-error"></p>
        <button type="submit" class="btn btn-primary" id="btnLogin">Entrar</button>
        <p class="auth-footer-link"><a href="#" id="linkEsqueciSenha">Esqueci a senha</a></p>
        <p class="auth-footer-link">N√£o tem conta? <a href="#" id="linkRegistro">Cadastre-se como volunt√°rio</a></p>
        <p class="auth-footer-link" id="setupLinkWrap" style="display: none;"><a href="#" id="linkSetup">Configurar primeiro admin (deploy)</a></p>
      </form>
    </div>
    <div class="auth-card" id="mustChangePasswordCard" style="display: none;">
      <div class="auth-header">
        <div class="logo"><span class="logo-icon">‚óá</span><span class="logo-text">Celeiro SP</span></div>
        <p class="auth-subtitle">Troque sua senha (primeiro acesso)</p>
      </div>
      <form id="mustChangePasswordForm" class="auth-form">
        <div class="form-group">
          <label for="firstAccessSenhaAtual">Senha atual (tempor√°ria)</label>
          <input type="password" id="firstAccessSenhaAtual" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password" required>
        </div>
        <div class="form-group">
          <label for="firstAccessSenhaNova">Nova senha</label>
          <input type="password" id="firstAccessSenhaNova" placeholder="M√≠nimo 6 caracteres" autocomplete="new-password" minlength="6" required>
        </div>
        <div class="form-group">
          <label for="firstAccessSenhaConfirmar">Confirmar nova senha</label>
          <input type="password" id="firstAccessSenhaConfirmar" placeholder="Repita a nova senha" autocomplete="new-password" minlength="6" required>
        </div>
        <p id="firstAccessError" class="auth-error"></p>
        <p id="firstAccessSuccess" class="auth-success" style="display: none;"></p>
        <button type="submit" class="btn btn-primary" id="btnFirstAccessSubmit">Trocar senha</button>
      </form>
    </div>
    <div class="auth-card" id="forgotPasswordCard" style="display: none;">
      <div class="auth-header">
        <div class="logo"><span class="logo-icon">‚óá</span><span class="logo-text">Celeiro SP</span></div>
        <p class="auth-subtitle">Redefini√ß√£o de senha</p>
      </div>
      <form id="forgotPasswordForm" class="auth-form">
        <div class="form-group">
          <label for="forgotEmail">Email</label>
          <input type="email" id="forgotEmail" placeholder="seu@email.com" autocomplete="email">
        </div>
        <p id="forgotError" class="auth-error"></p>
        <p id="forgotSuccess" class="auth-success" style="display: none;"></p>
        <button type="submit" class="btn btn-primary" id="btnForgotSubmit">Enviar link</button>
        <p class="auth-footer-link"><a href="#" id="linkForgotVoltar">Voltar ao login</a></p>
      </form>
    </div>
    <div class="auth-card" id="resetPasswordCard" style="display: none;">
      <div class="auth-header">
        <div class="logo"><span class="logo-icon">‚óá</span><span class="logo-text">Celeiro SP</span></div>
        <p class="auth-subtitle">Defina sua nova senha</p>
      </div>
      <form id="resetPasswordForm" class="auth-form">
        <div class="form-group">
          <label for="resetNovaSenha">Nova senha</label>
          <input type="password" id="resetNovaSenha" placeholder="M√≠nimo 6 caracteres" autocomplete="new-password" minlength="6">
        </div>
        <div class="form-group">
          <label for="resetConfirmarSenha">Confirmar nova senha</label>
          <input type="password" id="resetConfirmarSenha" placeholder="Repita a senha" autocomplete="new-password" minlength="6">
        </div>
        <p id="resetError" class="auth-error"></p>
        <p id="resetSuccess" class="auth-success" style="display: none;"></p>
        <button type="submit" class="btn btn-primary" id="btnResetSubmit">Redefinir senha</button>
        <p class="auth-footer-link"><a href="#" id="linkResetVoltar">Voltar ao login</a></p>
      </form>
    </div>
    <div class="auth-card" id="setupCard" style="display: none;">
      <div class="auth-header">
        <div class="logo"><span class="logo-icon">‚óá</span><span class="logo-text">Celeiro SP</span></div>
        <p class="auth-subtitle">Criar primeiro admin (ap√≥s deploy)</p>
      </div>
      <form id="setupForm" class="auth-form">
        <div class="form-group">
          <label for="setupSecret">C√≥digo SETUP_SECRET</label>
          <input type="password" id="setupSecret" autocomplete="off" placeholder="Cole o valor de SETUP_SECRET do Railway">
        </div>
        <div class="form-group">
          <label for="setupEmail">Email do admin</label>
          <input type="email" id="setupEmail" placeholder="admin@exemplo.com">
        </div>
        <div class="form-group">
          <label for="setupNome">Nome</label>
          <input type="text" id="setupNome" placeholder="Seu nome">
        </div>
        <div class="form-group">
          <label for="setupSenha">Senha (m√≠n. 6 caracteres)</label>
          <input type="password" id="setupSenha" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
        </div>
        <p id="setupError" class="auth-error"></p>
        <p id="setupSuccess" class="auth-success" style="display: none;"></p>
        <button type="submit" class="btn btn-primary" id="btnSetup">Criar admin</button>
        <p class="auth-footer-link"><a href="#" id="linkSetupVoltar">Voltar ao login</a></p>
      </form>
    </div>
    <div class="auth-card" id="registerCard" style="display: none;">
      <div class="auth-header">
        <div class="logo"><span class="logo-icon">‚óá</span><span class="logo-text">Celeiro SP</span></div>
        <p class="auth-subtitle">Cadastro de volunt√°rio</p>
      </div>
      <form id="registerForm" class="auth-form">
        <div class="form-group">
          <label for="registerNome">Nome completo</label>
          <input type="text" id="registerNome" placeholder="Seu nome">
        </div>
        <div class="form-group">
          <label for="registerEmail">Email</label>
          <input type="email" id="registerEmail" placeholder="seu@email.com">
        </div>
        <div class="form-group">
          <label for="registerPass">Senha</label>
          <input type="password" id="registerPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
        </div>
        <p id="registerError" class="auth-error"></p>
        <button type="submit" class="btn btn-primary" id="btnRegister">Cadastrar</button>
        <p class="auth-footer-link"><a href="#" id="linkLogin">Voltar ao login</a></p>
      </form>
    </div>
  </div>

  <!-- Modal Perfil do volunt√°rio -->
  <div id="modalPerfilVoluntario" class="modal" aria-hidden="true">
    <div class="modal-backdrop"></div>
    <div class="modal-box modal-perfil">
      <div class="modal-header">
        <h2>Perfil do volunt√°rio</h2>
        <button type="button" class="modal-close" id="modalPerfilVoluntarioClose" aria-label="Fechar">&times;</button>
      </div>
      <div class="modal-body" id="modalPerfilVoluntarioBody">
        <div id="perfilVoluntarioConteudo"></div>
      </div>
    </div>
  </div>

  <!-- Modal Enviar Email -->
  <div id="modalEmail" class="modal modal-email-box" aria-hidden="true">
    <div class="modal-backdrop"></div>
    <div class="modal-box">
      <div class="modal-header">
        <h2>Enviar email</h2>
        <button type="button" class="modal-close" id="modalClose" aria-label="Fechar">&times;</button>
      </div>
      <div class="modal-body">
        <p class="modal-info">Destinat√°rios: <strong id="modalDestCount">0</strong></p>
        <div class="form-group">
          <label for="emailSubject">Assunto</label>
          <input type="text" id="emailSubject" placeholder="Ex: Bem-vindo ao Celeiro S√£o Paulo">
        </div>
        <div class="form-group">
          <label for="emailBodyBase">Rascunho (base do email)</label>
          <textarea id="emailBodyBase" rows="6" placeholder="Digite aqui o rascunho do email. Depois clique em Revisar com IA para melhorar o texto (links em bot√µes, t√≠tulos em negrito, tom profissional)."></textarea>
          <button type="button" class="btn btn-ghost btn-sm" id="btnReviewLLM" style="margin-top:6px">‚ú® Revisar com IA</button>
          <p id="emailReviewError" class="auth-error" role="alert" style="margin-top:6px;min-height:1.5em"></p>
        </div>
        <div class="form-group">
          <label>Mensagem para envio (edite abaixo)</label>
          <div id="emailBodyEditor" class="email-body-editor" contenteditable="true" data-placeholder="Ap√≥s Revisar com IA, o HTML aparecer√° aqui. Voc√™ pode editar. Ou digite/cole HTML ou texto diretamente."></div>
        </div>
        <p class="form-hint">Use <code>[nome]</code> para substituir pelo nome do volunt√°rio. Os emails s√£o enviados pelo disparador da plataforma.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-ghost" id="modalCancel">Cancelar</button>
        <button type="button" class="btn btn-ghost" id="btnReenviarUltimo" style="display: none;">Reenviar √∫ltimo envio</button>
        <button type="button" class="btn btn-primary" id="btnSendEmail">Enviar</button>
      </div>
      <div id="sendResult" class="send-result" style="display: none;"></div>
    </div>
  </div>

  <!-- Modal: Nova Escala -->
  <div id="modalNovaEscala" class="modal" aria-hidden="true">
    <div class="modal-backdrop"></div>
    <div class="modal-box">
      <div class="modal-header">
        <h2>Nova escala</h2>
        <button type="button" class="modal-close" id="modalNovaEscalaClose">&times;</button>
      </div>
      <form id="formNovaEscala" class="modal-body">
        <div class="form-group">
          <label for="escalaNovoNome">Nome da escala</label>
          <input type="text" id="escalaNovoNome" placeholder="Ex: Culto 02/03" required>
        </div>
        <div class="form-group">
          <label for="escalaNovaData">Data (opcional)</label>
          <input type="date" id="escalaNovaData">
        </div>
        <div class="form-group">
          <label for="escalaNovaDescricao">Descri√ß√£o (opcional)</label>
          <input type="text" id="escalaNovaDescricao" placeholder="Informa√ß√µes adicionais">
        </div>
        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" id="escalaNovoAtivo" checked>
            Ativa (aceita candidaturas via link p√∫blico)
          </label>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-ghost" id="modalNovaEscalaCancel">Cancelar</button>
          <button type="submit" class="btn btn-primary">Criar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal: Editar Escala -->
  <div id="modalEditarEscala" class="modal" aria-hidden="true">
    <div class="modal-backdrop"></div>
    <div class="modal-box">
      <div class="modal-header">
        <h2>Editar escala</h2>
        <button type="button" class="modal-close" id="modalEditarEscalaClose">&times;</button>
      </div>
      <form id="formEditarEscala" class="modal-body">
        <input type="hidden" id="editarEscalaId">
        <div class="form-group">
          <label for="editarEscalaNome">Nome da escala</label>
          <input type="text" id="editarEscalaNome" required>
        </div>
        <div class="form-group">
          <label for="editarEscalaData">Data (opcional)</label>
          <input type="date" id="editarEscalaData">
        </div>
        <div class="form-group">
          <label for="editarEscalaDescricao">Descri√ß√£o (opcional)</label>
          <input type="text" id="editarEscalaDescricao">
        </div>
        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" id="editarEscalaAtivo">
            Ativa (aceita candidaturas via link p√∫blico)
          </label>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-ghost" id="modalEditarEscalaCancel">Cancelar</button>
          <button type="submit" class="btn btn-primary">Salvar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Script inline: esconde loading e mostra overlay/form conforme URL (fix iOS e sess√£o) -->
  <script>
    (function() {
      var q = window.location.search || '';
      var escala = q.indexOf('escala=') >= 0;
      var checkin = q.indexOf('checkin=') >= 0;
      if (escala || checkin) {
        var loading = document.getElementById('loading');
        var dashboard = document.querySelector('.dashboard');
        if (loading) loading.style.display = 'none';
        if (dashboard) dashboard.style.display = 'none';
        if (escala) {
          var ov = document.getElementById('escalaPublicOverlay');
          if (ov) ov.style.display = 'flex';
        }
        if (checkin) {
          var ov = document.getElementById('checkinPublicOverlay');
          if (ov) ov.style.display = 'flex';
        }
      } else if (window.location.hash !== '#cadastro') {
        var loading = document.getElementById('loading');
        if (loading) loading.style.display = 'none';
        try {
          var stored = localStorage.getItem('celeiro_admin_auth');
          if (!stored) {
            var auth = document.getElementById('authOverlay');
            if (auth) auth.style.display = 'flex';
          }
        } catch (_) {
          var auth = document.getElementById('authOverlay');
          if (auth) auth.style.display = 'flex';
        }
      }
    })();
  </script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="app.js?v=1.0.5"></script>
</body>
</html>
